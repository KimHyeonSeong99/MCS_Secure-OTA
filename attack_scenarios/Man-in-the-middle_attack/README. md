# 2. Man-in-the-middle Attack

## 공격 시나리오 1: OTA 웹페이지를 캡처하여 파일 유출 및 변조

### 공격 시나리오 전제 조건
해킹을 통해 관리자가 펌웨어를 업로드 하기 위해 사용하는 컴퓨터(장비)의 지정 프록시 서버를를 공격자의 프록시 서버로 변경한 것으로 가정한다.

### 공격 시나리오 수행 방법
1. 업데이트를 파일 업로드를 수행할 컴퓨터의 프록시 서버 IP 주소를 공격자의 IP 주소로 할당한다. 
2. burf 등의 툴을 이용하여 Web에서 파일 업로드를 수행할 때 서버로 전송되는 패킷을 캡처한다.
3. 캡처된 패킷에서 암호화 되지 않은 파일 내용을 변조하여 전송한다.
4. 인증이 없는 차량은 해당 악성 파일을 설치한다.
---

## 공격 시나리오 2: 서버 IP 주소 요청의 응답을 변조하여 가짜 서버 연결 

### 공격 시나리오 전제 조건
해킹을 통해 프록시 서버 혹은 DNS 서버를 장악하여 IP 주소에 대한 리스폰스를 변조할 수 있다고 가정한다.

### 공격 시나리오 수행 방법
1. 공격자가 리스폰스된 IP 주소를 위조하였다고 가정하고 차량에 해당하는 직접 Client를 가짜 MQTT 브로커 혹은 OTA 서버에 연결한다.
2. 공격자는 차량의 연결 및 업데이트 요청이 확인되면 해당 차량 OTA 포멧에 맞게 악성 코드 패킷을 생성한다.
3. 생성된 악성 패킷을 차량으로 전송한다.
4. 인증이 없는 차량은 해당 악성 파일을 설치한다.

### 보안 요소 추가 시나리오
#### 1. 서버 측: HTTPS(SSL/TLS) 통신
=> 차량을 해킹하여 가짜 CA 파일을 주입한 후 해당 공격을 수행한다.
=> 공격 시나리오 수행을 위해 차량에 해당하는 Client에 가짜 서버와 동일한 CA 파일을 추가하여 시나리오를 수행한다.

#### 2. 차량 측: 전자서명 검증
=> 차량을 해킹하여 서버의 공개키가 아닌 공격자의 공개키를 사용하도록 변경한 후 해당 공격을 수행한다.
=> 공격 시나리오 수행을 위해 차량에 해당하는 Client에 공격자의 공개키를 주입하여 시나리오를 수행한다. (이때, 서버의 공개키와 동일한 이름으로 주입하여 대체하도록 한다.)
---

---


## 공격 시나리오 3: 차량으로 전송되는 업데이트 패킷 변조

### 공격 시나리오 전제 조건
해킹을 통해 무선 통신을 중계하는 라우터를 장악하여 IP 주소에 대한 리스폰스를 변조할 수 있다고 가정한다.

### 공격 시나리오 수행 방법
1. 업데이트 파일을 정상 OTA 경로를 통해 업로드 한다.
2. 업데이트 패킷을 차량으로 전송 중 라우터에 의해 강제로 공격자의 IP로 패킷이 경유하게 한것으로 가정하고 공격자 IP로 파일 전송
3. 공격자의 IP를 업데이트 서버로 위장한 것으로 가정하고 차량에 변조된 패킷을 전송한다.
4. 인증이 없는 차량은 해당 악성 파일을 설치한다.
---

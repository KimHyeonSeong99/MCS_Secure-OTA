# Attack Scenarios

## Secure OTA

---

## 1. Supply Chain Attack

### 공격 시나리오 1: 정식 OTA 파일 업로드 웹페이지를 통해 악성 코드 업데이트

- 공격자는 정식 OTA 파일 업로드 웹페이지를 통해 악성코드를 포함한 .bin 파일을 업로드함
- 보안이 적용되지 않은 OTA 시스템에서는 해당 악성코드가 차량 ECU에 설치됨

#### 공격 시나리오 수행 방법
1. 공격자는 타겟 ECU에 맞는 .bin 파일을 제작
2. OTA 업로드 웹사이트에 해당 파일 업로드
3. 인증이 없는 차량은 해당 악성 파일을 설치하게 됨

#### 보안 솔루션
- 관리자 계정 인증을 통해 업로드 기능 제한
- 관리자 장비의 서명을 서버에서 인증하여, 인증된 파일만 설치
- 별도 서명 툴을 통해 파일 업로드 전 전자서명을 생성하고 서버/차량에서 검증

---

### 공격 시나리오 2: MQTT broker에 악성 코드 혹은 URL publishing

- 공격자는 MQTT broker에 접근하여 악성 코드나 URL을 publish
- 차량은 subscribe된 메시지를 통해 인증 없이 해당 파일을 설치함

#### 공격 시나리오 수행 방법
1. 인증된 차량 해킹 후 MQTT broker의 IP 확인
2. broker에 악성 파일이나 다운로드 URL을 publish
3. 차량은 인증 없이 해당 파일을 설치

#### 보안 솔루션
- MQTT broker에서 ID/PW 설정을 통해 접근 제한
- EMQX 등의 MQTT 어플리케이션으로 IP 기반 접근 제어
- publish된 메시지에 서명을 포함하고 차량에서 이를 인증

---

## 2. Man-in-the-middle Attack

### 공격 시나리오 1: OTA 웹페이지를 캡처하여 파일 유출 및 변조

#### 공격 시나리오 수행 방법
1. 관리자 장비의 프록시를 공격자의 것으로 설정
2. 파일 업로드 시 burp 등의 MITM 툴로 패킷 캡처 및 유출
3. 유출된 파일을 변조하여 서버에 재전달
4. 차량은 해당 파일을 설치하게 됨

#### 보안 솔루션
- 서버 전송 시 업로드 데이터 암호화
- 전자 서명을 통해 변조 여부 검증
- 프록시 고정 등을 통해 지정 장비에서만 업로드 허용

---

### 공격 시나리오 2: 프록시 조작으로 가짜 서버 연결 (예린님 작성)

#### 공격 시나리오 수행 방법
1. 공격자가 OTA 도메인의 IP를 위조하여 자신의 서버로 유도
2. 차량은 가짜 OTA 서버에 접속하여 악성 파일 다운로드
3. 유사한 형식의 OTA 패키지를 받아 악성코드 포함 소프트웨어로 업데이트됨

#### 보안 솔루션
- HTTPS 기반 통신과 인증서 검증 강화
- OTA 파일에 전자 서명 및 무결성 검증 적용

---

### 공격 시나리오 3: DNS Spoofing을 통해 가짜 OTA 서버 연결 (정우님 작성)

#### 공격 시나리오 수행 방법
1. Bettercap, dnsmasq를 사용하여 DNS 요청을 공격자의 IP로 리디렉션
2. Self-signed 인증서로 HTTPS 통신 위장
3. 인증서 검증 미흡 시 차량은 공격자의 서버를 신뢰
4. 악성 OTA 파일과 서명, 해시 전달 → 차량 설치

#### 보안 솔루션
- 서버 측: HTTPS(SSL/TLS) 통신
- 차량 측: Root CA 검증, 전자 서명 및 해시 검증

---

### 공격 시나리오 4: 프록시 조작을 통한 전송 패킷 가로채기

#### 공격 시나리오 수행 방법
1. 정상 관리자 파일 업로드
2. 서버에서 broker로 publish
3. 프록시 조작을 통해 파일이 공격자에게 전달됨
4. 변조된 파일을 정상적인 IP를 위장해 다시 전송
5. 차량은 무결성 검증 없이 설치 진행

#### 보안 솔루션
- 파일 전송 시 암호화 적용
- 전자 서명 및 무결성 검증 필수

---

## 3. Replay Attack

### 공격 시나리오: 과거 업데이트 패킷 재사용

#### 공격 시나리오 수행 방법
1. 과거 OTA 패킷을 캡처 및 보관
2. 최신 버전의 취약점을 공략하기 위해 과거 버전 전송
3. 차량은 메시지 신선도 검증 미흡으로 해당 패킷 설치
4. 이후 알려진 취약점을 통해 공격 수행

#### 보안 솔루션
- OTA 패킷에 버전 정보 포함 및 버전 체크 수행
- 타임스탬프를 통한 신선도 검증
- 업데이트마다 변화하는 테이블 값으로 고유성 확보

---
